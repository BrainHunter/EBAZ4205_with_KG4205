# EBAZ4205_with_KG4205
Example project for the EBAZ4205 in combination with KG4205 board.
This project is based on [EBAZ4205_base_wo_crystal](https://github.com/BrainHunter/EBAZ4205_base_wo_crystal) 

* Created with Vivado 2019.2
* tested with petalinux 2019.2

# Status:	
Currently only VGA output is implemented. 
Camera is TBD.

#build 

## Vivado Project:
* generate bitstream file
* export hardware with bitstream included: File->Export->Export Hardware

## petalinux:



```shell
cd petalinux

#optional: update hw description
petalinux-config --get-hw-description=../

#build the linux:
petalinux-build

petalinux-package --boot --format BIN --fsbl ./images/linux/zynq_fsbl.elf --fpga ../EBAZ4205_with_KG4205.runs/impl_1/Zynq_proc_wrapper.bit --u-boot --force
```


## VGA
The VGA output is tested with 640x480. Current design includes a Testpattern generator and a video framebuffer read block.

### TestPatternGenerator:
With these commands, data is generated by the test pattern generator.
To activate the output set these register values:

```shell
#activate timing controller:
devmem 0x43c10000 32 5
#set image size in the tpg:
devmem 0x43c00010 32 480
devmem 0x43c00018 32 640
#set color bar pattern in the tpg: 
devmem 0x43c00020 32 0x9 
#enable the tpg:
devmem 0x43c00000 32 0x81 	#control register = ap_start | auto_start
```



### Framebuffer output via DMA:
These commands set the registers so the output will display the framebuffer configured in the linux.

```shell
#Timing controller:
#enable:
devmem 0x43c10000 32 5
#status:
devmem 0x43c10004 32
#0x00013200			

#test pattern generator:
devmem 0x43c00000 32		#status
# 0x4

#set size:
devmem 0x43c00010 32 480
devmem 0x43c00018 32 640

devmem 0x43c00020 32 0x0 	#tpg pattern = input
devmem 0x43c00098 32 1		#enable slave input

#framebuffer read: 
devmem 0x43c20010 32 640	#width
devmem 0x43c20018 32 480	#height
devmem 0x43c20020 32 2560	#stide (4*640)
devmem 0x43c20028 32 10		#memory data format = RGBX
devmem 0x43c20030 32 0xf800000	#address as set in the devce tree


devmem 0x43c20000 32 0x81 	# enable dma
devmem 0x43c00000 32 0x81 	# enable tpg #control register = ap_start | auto_start


```

## Camera
TBD.
